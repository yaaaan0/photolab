<template lang="pug">
  #order
    v-app
      v-form(@submit.prevent="onSubmit")
        v-stepper(v-model='e6' vertical)
          v-stepper-step(:complete='e6 > 1' step='1' color="#677d35" complete)  é ç´„èªªæ˜
          v-stepper-content(step='1')
            v-card.step1.mb-12(outlined)
              p æ­¤å–®ç‚ºå ±åé ç´„ç”¨, ä¸æ”¶å–è¨‚é‡‘, å› æ­¤ä¹Ÿä¸ä»£è¡¨æª”æœŸé ç´„æˆåŠŸå–”ï¼æ”¶åˆ°è¡¨å–®å¾Œ, æˆ‘å€‘æœƒå›è¦†æ‚¨æ‰€éœ€æ–¹æ¡ˆå…§å®¹
                br
                br
                | ğŸ”¸ GP photolabåªæä¾›æ”å½±æœå‹™ï¼ˆä¸å«é€ å‹ã€ç¦®æœï¼Œç‚ºäº†å©šç´—å½±åƒçš„è³ªæ„Ÿ,è«‹å¾æ”å½±æ–¹æ¡ˆçš„æ¨è–¦åå–®è‡ªè¡ŒæŒ‘é¸æ‚¨å–œæ„›çš„é€ å‹å¸«åŠç¦®æœå» å•†)
                br
                | ğŸ”¸ GP photolabå…¨é¢åœæ¥å©šç¦®ç´€éŒ„æ”å½±
                br
                | ğŸ”¸ ç‚ºäº†ç¢ºä¿æ”å½±åŠä¿®ç‰‡çš„å“è³ª, è«‹è©³ç´°ç¢ºå®šå©šç¦®æ—¥æœŸ/ å©šç´—æ‹æ”èˆ‡å©šç¦®æ—¥æœŸå‰å¾Œç›¸å·®è‡³å°‘4-6å€‹æœˆä»¥ä¸Š/ å¦‚å°šæœªæœ‰å©šæœŸä¹Ÿå¯ä»¥å¡«å–®å…ˆç´¢å–æ–¹æ¡ˆåƒè€ƒ
                br
                | ğŸ”¸ GP photolabæœƒä¾æ“šå®¢æˆ¶æ‰€é ç´„çš„æ”å½±æ™‚ç¨‹, ä»¥Emailèˆ‡æ‚¨è¯ç¹«ä¸¦è¨è«–æ­£å¼é ç´„æ™‚é–“åŠæ‹æ”äº‹é …
                br
                | ğŸ”¸ é›™æ–¹è¨è«–å‡ºä¸€è‡´çš„æ–¹å‘å¾Œï¼ˆæ‹æ”äº‹é …ã€æ™‚ç¨‹ã€åƒ¹æ ¼ç­‰ï¼‰, GP photolabæœƒEmailæ­£å¼è¨‚å–®, æ”¶åˆ°å¾Œ, æ‚¨å³å¯å…ˆå¡«å¦¥è³‡æ–™ä¸¦é–‹å§‹å°‹æ‰¾æ‹æ”é¢¨æ ¼ã€é€ å‹ã€ç¦®æœå›‰ï¼è¨»: æª”æœŸä¸åšå£é ­ä¿ç•™, æ˜¯ä»¥åŒæ™‚æ”¶åˆ°è¨‚é‡‘ï¼‹è¨‚å–®æ‰ç®—æª”æœŸé ç´„æˆåŠŸ
                br
                | ğŸ”¸ è‹¥æœ‰æµ·å¤–å©šç´—æˆ–è¼ƒé åœ°å€æ‹æ”éœ€æ±‚, è«‹æå‰å‘ŠçŸ¥
                br
                | ğŸ”¸ è»Šè³‡: æ‹æ”åœ°é»ä»¥è‡ºå—å„ªå…ˆ, æ–°äººè»Šé¦¬è‡ªç†, å°å—ä»¥å¤–éœ€è»Šé¦¬å‡ºå·®è²»
            v-card.step1.mb-12(outlined)
              P ğŸ“£2020å¹´åº¦é™å®š- é†«è­·äººå“¡æ‹æ”ä¸‰å¥—å©šç´—ç‰¹åˆ¥å„ªæƒ - 85æŠ˜
                br
                | æ„Ÿè¬é†«è­·äººå“¡æ–¼å‰ç·šé˜²ç–«çš„è¾›å‹
                br
                | ã€å‡¡å…·æœ‰é†«äº‹äººå“¡èº«ä»½, å³æ—¥èµ·é ç´„ä»Šå¹´åº•å‰æ‹æ”ä¸‰å¥—å©šç´—æ–¹æ¡ˆ, å³äº«85æŠ˜å„ªæƒ ã€
                br
                | å„ªæƒ å°è±¡ï¼šé†«å¸«ã€è­·ç†å¸«ã€è—¥å¸«ã€é†«é™¢è¡Œæ”¿äººå“¡ç­‰é†«äº‹äººå“¡
                br
                | å„ªæƒ é™å®šæ‹æ”æ™‚é–“ï¼š2020å¹´åº•å‰å®Œæˆæ‹æ”
                br
                | é ç´„æ–¹å¼ï¼šå¡«å¯«é ç´„å–®æ™‚å‚™è¨»ã€Œé†«è­·äººå“¡ã€
                br
                | å‡ºç¤ºè­‰ä»¶ï¼šè«‹æ–¼å°På›ä¿¡é ç´„å–®å¾Œ, æ–¼ä¿¡ä»¶å‡ºç¤ºè­‰ä»¶ï¼ˆé†«é™¢è­˜åˆ¥è­‰ã€å·¥ä½œè­‰ç­‰ï¼‰
            v-card.step1.mb-12(outlined)
              P ğŸ“£ GPæ”å½±å¸«è‡³2021å¹´ä¸ŠåŠå¹´çš„æª”æœŸçš†å·²é¡æ»¿ (è«‹é¸æ“‡åœ˜éšŠå…¶ä»–æ”å½±å¸«æ‹æ”ï¼‰
                br
                | GPæ”å½±å¸«æª”æœŸåªé–‹æ”¾åˆ°2021å¹´ä¸ŠåŠå¹´, å¦‚å¸Œæœ›ç”±å¥¹æ‹æ”, æœ€å¿«é ˆæ’éšŠç­‰å€™å¥¹2021å¹´ä¸‹åŠå¹´çš„æª”æœŸï¼ˆé è¨ˆä»Šå¹´åº•æ‰æœƒé–‹æ”¾ï¼‰, å› æ’éšŠäººæ•¸çœ¾å¤š, æª”æœŸä¹Ÿé™é¡å°‘é‡, å¦‚æœ‰å©šæœŸæ€¥è¿«æ€§çš„æ–°äºº, è«‹åƒè€ƒåœ˜éšŠå…¶ä»–æ”å½±å¸«å€‘
            v-checkbox(v-model='agreeStatement' color="#677d35" label="è©³ç´°é–±è®€ä¸”åŒæ„")
            v-btn(rounded color='#677d35' @click='e6 = 1' dark) ä¸Šä¸€æ­¥
            v-btn(rounded color='#677d35' :disabled="invalid" @click='e6 = 2' href='#' dark) ä¸‹ä¸€æ­¥
          v-stepper-step(rounded :complete='e6 > 2' step='2' color="#677d35") é¸æ“‡æ–¹æ¡ˆ
          v-stepper-content(step='2')
            v-card.step2.mb-12
              h3 é¸æ“‡æ‚¨çš„æ‹æ”é …ç›®
              v-radio-group(v-model='project' mandatory)
                v-radio(color="#677d35" value="ä¸ƒå¤•é™å®šç¹”å¥³åŒ…å¥—æ–¹æ¡ˆ" label="ä¸ƒå¤•é™å®šç¹”å¥³åŒ…å¥—æ–¹æ¡ˆ/ æ‹æ”æ—¥æœŸé™2020å¹´8æœˆï½2021å¹´2æœˆ, åƒèˆ‡æ”å½±å¸«ï¼šæ¦®æ ¼ã€å£¹å£¹ã€åˆ·ç‰™  (åˆ·ç‰™åªé–‹æ”¾æ˜å¹´1,2æœˆ)")
                v-radio(color="#677d35" value="ä¸‰å¥—å©šç´—æ‹æ”" label="ä¸‰å¥—å©šç´—æ‹æ”/ 2020å¹´åº•å‰æ¯å€‹æœˆå‰åçµ„é ç´„å¯äº«9æŠ˜å„ªæƒ (å„ªæƒ ä¸å«å©šç´—å´éŒ„)")
                v-radio(color="#677d35" value="ä¸€å¥—å©šç´—" label="ä¸€å¥—å©šç´—/ é–‹æ”¾å¤šä¸€å¥—ä¾¿æœæ‹æ”")
                v-radio(color="#677d35" value="å–®äººå©šç´—" label="å–®äººå©šç´—/ æ”å½±å¸«GPåœæ¥æ­¤æ–¹æ¡ˆ")
                v-radio(color="#677d35" value="å§å¦¹å©šç´—" label="å§å¦¹å©šç´—/ æ”å½±å¸«GPåœæ¥æ­¤æ–¹æ¡ˆ")
                v-radio(color="#677d35" value="å­•åª½å’ªå¯«çœŸ" label="å­•åª½å’ªå¯«çœŸ /ä¸æ‹ç¦®æœã€ä¾¿æœç‚ºä¸»; æ”å½±å¸«GPåœæ¥æ­¤æ–¹æ¡ˆ; æ–°äººå›å¨˜å®¶æ‰“9æŠ˜")
                v-radio(color="#677d35" value="è¦ªå­å¯«çœŸ" label="è¦ªå­å¯«çœŸ /ä¸æ‹ç¦®æœã€ä¾¿æœç‚ºä¸»; æ”å½±å¸«GPåœæ¥æ­¤æ–¹æ¡ˆ; æ–°äººå›å¨˜å®¶æ‰“9æŠ˜")
                v-radio(color="#677d35" value="æƒ…ä¾¶å¯«çœŸ" label=" æƒ…ä¾¶å¯«çœŸ /ä¸æ‹ç¦®æœã€ä¾¿æœç‚ºä¸»; æ”å½±å¸«GPåœæ¥æ­¤æ–¹æ¡ˆ")
                v-radio(color="#677d35" value="äººåƒå¯«çœŸ" label="äººåƒå¯«çœŸ /ä¸æ‹ç¦®æœã€ä¾¿æœç‚ºä¸»; æ”å½±å¸«GPåœæ¥æ­¤æ–¹æ¡ˆ")
              h3 é¸æ“‡æ‚¨çš„æ‹æ”å¸«
              v-chip-group(v-model='photographer' column multipl emandatory color="#677d35")
                v-chip(value="GP" filter outlined) GP
                v-chip(value="æ¦®æ ¼" filter outlined) æ¦®æ ¼
                v-chip(value="å£¹å£¹" filter outlined) å£¹å£¹
                v-chip(value="åˆ·ç‰™" filter outlined) åˆ·ç‰™
              h3 é¸æ“‡æ‚¨çš„æ‹æ”æ—¥æœŸ
              v-col(cols='12' sm='6' md='4')
                v-dialog(ref='dialog' v-model='modal' :return-value.sync='date' persistent width='350px')
                  template(v-slot:activator='{ on, attrs }')
                    v-text-field(
                      v-model='date'
                      label="Select Date"
                      prepend-icon='mdi-calendar'
                      readonly v-bind='attrs'
                      v-on='on'
                      color="#677d35"
                      clearable
                      @click:clear="date = null"
                      :allowed-dates="allowedDates"
                      )
                  v-date-picker(
                    v-model='date'
                    scrollable
                    color="#677d35"
                    :min="new Date().toISOString()")
                    v-spacer
                    v-btn(text color='#677d35' rounded @click='modal = false') å–æ¶ˆ
                    v-btn(text color='#677d35' rounded @click='$refs.dialog.save(date)') ç¢ºèª
            v-btn(rounded color='#677d35'  @click='e6 = 1' href='#' dark) ä¸Šä¸€æ­¥
            v-btn(v-if="(this.$data.agreeStatement === false || this.$data.date === null || this.$data.photographer === null)" rounded color='#677d35'  @click='check' dark) ä¸‹ä¸€æ­¥
            v-btn(v-else rounded color='#677d35'  @click='e6 = 3' href='#' dark) ä¸‹ä¸€æ­¥
          v-stepper-step(:complete='e6 > 3' step='3' color="#677d35") é ç´„ç¢ºèª
          v-stepper-content(step='3')
            v-card.step3.mb-12
              validation-observer( ref="observer" v-slot="{ invalid }")
                v-card-text
                  validation-provider(v-slot="{ errors }" rules="required")
                    v-text-field(
                        color="#000000"
                        v-model="project"
                        filled
                        rounded
                        readonly
                        prefix=' æ‹æ”é …ç›®ï½œ')
                  validation-provider(v-slot="{ errors }" rules="required")
                    v-text-field(
                      color="#000000"
                      v-model="date"
                      filled
                      rounded
                      readonly
                      prefix=' æ‹æ”æ—¥æœŸï½œ')
                  validation-provider(v-slot="{ errors }" rules="required")
                    v-text-field(
                      color="#000000"
                      v-model="photographer"
                      filled
                      rounded
                      readonly
                      prefix=' æ”å½±å¸«ï½œ')

                  v-btn(rounded color='#677d35' @click='e6 = 2' href='#' dark) ä¸Šä¸€æ­¥
                  v-btn(:disabled="invalid" rounded color='#677d35' type="submit" dark) é€å‡º
</template>

<script>
import { required } from 'vee-validate/dist/rules'
import { extend, ValidationObserver, ValidationProvider, setInteractionMode } from 'vee-validate'

setInteractionMode('eager')

extend('required', {
  ...required,
  message: '{_field_} can not be empty'
})

export default {
  data () {
    return {
      e6: 1,
      modal: false,
      date: null,
      agreeStatement: false,
      project: '',
      photographer: null
    }
  },
  components: {
    ValidationProvider,
    ValidationObserver
  },
  methods: {
    check () {
      if (this.$data.agreeStatement === false) {
        this.$swal({
          title: 'é ç´„èªªæ˜è«‹æ‰“å‹¾'
        })
      } else if (this.$data.photographer === null) {
        this.$swal({
          title: 'è«‹é¸æ“‡æ”å½±å¸«'
        })
      } else if (this.$data.date === null) {
        this.$swal({
          title: 'è«‹é¸æ“‡æ—¥æœŸ'
        })
      }
    },
    onSubmit () {
      this.$refs.observer.validate()
      this.axios.post(process.env.VUE_APP_API + '/users/order/' + this.$store.state.user.id, this.$data)
        .then(res => {
          if (res.data.success) {
            this.$swal({
              icon: 'success',
              title: 'è¡¨å–®æˆç«‹',
              showConfirmButton: false,
              timer: 1000
            })
            res.data.result.src = process.env.VUE_APP_API + '/albums/file/' + res.data.result.file
            setTimeout(() => {
              this.$router.push({ path: '/user/order', name: 'OrderList' })
            }, 1000)
          } else {
            this.$swal({
              icon: 'error',
              title: 'ç™¼ç”ŸéŒ¯èª¤',
              text: res.data.message
            })
          }
        })
        .catch(err => {
          this.$swal({
            icon: 'error',
            title: 'ç™¼ç”ŸéŒ¯èª¤',
            text: err.response.data.message
          })
        })
    }
  }
}
</script>
